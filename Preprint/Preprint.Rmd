---
title: "Modelling vaccination capacity at mass vaccination hubs and general practice clinics"
authors:
  - name: Mark Hanly
    department: Centre for Big Data Research in Health
    affiliation: UNSW Sydney
    email: m.hanly@unsw.edu.au
  - name: Tim Churches
    department: South Western Sydney Clinical School, Faculty of Medicine & Health, UNSW Sydney &
    affiliation: Ingham Institute for Applied Medical Research
  - name: Ois√≠n Fitzgerald
    department: Centre for Big Data Research in Health
    affiliation: UNSW Sydney
  - name: Ian Caterson
    department: Medical Lead, Royal Prince Alfred Hospital COVID Vaccination Clinic
    affiliation: Sydney Local Health District
  - name: Chandini Raina MacIntyre
    department: Biosecurity Research Program, The Kirby Institute
    affiliation: UNSW Sydney
  - name: Louisa Jorm
    department: Centre for Big Data Research in Health
    affiliation: UNSW Sydney
abstract: |
  COVID-19 population vaccination programs are underway globally. In Australia, the federal government has entered into three agreements for the supply of vaccines, with roll-out beginning for the highest priority groups in February 2021. Expansion of the vaccination program throughout February and March failed to meet government targets and this has been attributed to international supply issues. However, Australia has local capacity to manufacture one million doses of the AstraZeneca vaccine weekly and once fully operational this will greatly increase the national vaccination capacity. Under current plans, these vaccine doses will be distributed primarily through a network of general practices, to be joined in later phases by community pharmacies. It remains unclear whether these small distribution venues have the logistical capacity to administer vaccines at the rate they will become available. To inform this discussion, we applied stochastic queue network models to estimate the capacity of vaccination sites based on assumptions about appointment schedules, service times and available staff numbers. We specified distinct queueing models for two delivery modes: (i) mass vaccination hubs located in hospitals or sports arenas and (ii) smaller clinics situated in general practices or community pharmacies. Based on our assumed service times, the potential daily throughput for an eight hour clinic at a mass vaccination hub ranged from around 500 vaccinations for a relatively small hub to 1,400 vaccinations a day for a relatively large hub. For GP vaccination clinics, the estimated daily throughput ranged from about 100 vaccinations a day for a relatively small practice to almost 300 a day for a relatively large practice. Stress tests showed that for both delivery modes, sites with higher staff numbers were more robust to system pressures, such as increased arrivals or staff absences, and mass vaccination sites were more robust that GP clinics. Our analysis is accompanied by an interactive web-based queue simulation applet, which allows users to explore queue performance under their own assumptions regarding appointments, service times and staff availability. Different vaccine delivery modes offer distinct benefits and may be particularly appealing to specific population segments. A combination of expanded mass vaccination hubs and expanded GP vaccination is likely to achieve mass vaccination faster than either mode alone. 
  
keywords:
  - COVID-19
  - Vaccination
  - Queueing models
bibliography:  [packages.bib, references.bib]
csl: jama.csl
biblio-style: unsrt
header-includes:
  - \usepackage[british]{babel}
  - \usepackage{gensymb}
output: 
  rticles::arxiv_article:
    keep_tex: true
    includes:  
      in_header: my_header.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, error = FALSE, message = FALSE)

# libraries
library(queuecomputer)
library(DiagrammeR)
library(tidyverse)
library(lubridate)
library(kableExtra)
library(sparkline)
library(RColorBrewer)
sparkline(0)


# Source functions
source('../R/arrivals.R')
source('../R/helperFunctions.R')


# Load scenario data
load('../Data/queueTimesRPA.rda')
load('../Data/utilTimesRPA.rda')
load('../Data/queueTimesGP.rda')
load('../Data/utilTimesGP.rda')

updated <- rmarkdown::metadata$updated[1]

knitr::write_bib(.packages(), "packages.bib")

# the number of simulation runs, a constant
nSim <- 20
set.seed(123456789)
```

\newpage

# Introduction

Multiple SARS-CoV-2 vaccines have been demonstrated to be safe and efficacious in preventing severe COVID-19 disease, and population vaccination programs are currently under way around the world.[@polack2020safety; @baden2021efficacy; @voysey2021single] There is a clear imperative to vaccinate the bulk of the Australian population, and indeed the global population, as quickly as possible. Recent modelling work has demonstrated that higher vaccination coverage will reduce the size and duration of an epidemic in the event of an outbreak.[@sandmann2021potential; @macintyre2021navigating; @macintyre2020modelling, @zachreson2021will] Achieving herd immunity against COVID-19 will allow states and countries to open borders with more confidence and avoid expensive and disruptive lockdowns. Preventing the transmission of the SARS-CoV-2 virus will minimise opportunities for the virus to mutate, potentially resulting in more transmissible or deadly variants.

In Australia, the federal government has procured a supply of three different vaccines, including 20 million Pfizer/BioNTech doses and 51 million Novavax doses, which will be imported from overseas, and 54 million Oxford University/AstraZeneca doses, the bulk of which will be manufactured locally in Australia.[@vaccineAgreements] Roll-out of the national vaccination program began on 22 February 2021, with the Pfizer/BioNTech vaccine administered to the first of five priority phases though hospital hubs with access to the necessary -70\degree C ultra-cold-chain storage facilities. In February, the Australian Therapeutic Goods Administration (TGA) approved the use of the AstraZeneca vaccine, and roll-out of this vaccine to the second priority phase began in mid-March. The AstraZeneca vaccine can be stored in a standard vaccine refrigerator, allowing for distribution through general practitioners (GPs) and Community Pharmacies (CPs). In March, the TGA further approved storage of the Pfizer vaccine in a standard freezer at -20\degree C, broadening the potential distribution venues. 

The sustained number of vaccine doses administered per day is the key driver of achieving a high population coverage as quickly as possible. Projections indicate that a rate of 200,000 daily vaccinations would be required to deliver two doses each to all willing Australians in a six month period.[@hanly2021vaccinating] CSL, the pharmaceutical company responsible for manufacturing the AstraZeneca vaccine in Australia, aims to produce one million doses per week. This suggests that once local manufacturing is operational---combined with ongoing deliveries of the Pfizer vaccine, and future deliveries of the Novavax vaccine---there feasibly will be enough doses available to aim for the target of 200,000 administered doses per day.

What is less clear at this point in time is whether the logistical capacity exists to administer this number of doses at the rate they become available. The current roll-out plan centres on hospital hubs for Phase 1a and part of Phase 1b, private contractors and the Australian Defence Force for aged care facilities, and selected GPs and CPs for the balance of the population. Initial reports suggest that more than 4,500 accredited GPs [@hunt2021local] of a total of around 7,000 practices in Australia[@swerissen2018mapping] will participate in the second phase of the roll-out, with an as-yet-unknown number of CPs expected to join the distribution efforts for subsequent phases. Distribution through local GPs and CPs offers many benefits. Australian GPs are the main provider of the National Immunisation Program for other vaccines and are thus well set up to deliver vaccinations. CPs have been administering influenza vaccine for the past five years in different states. These primary healthcare venues have the advantage of drawing on existing networks and infrastructure, and will be convenient and familiar for patients. However, the potential capacity of GPs and CPs is limited by physical space, available staff and by the initial limited and variable vaccine supply, with current supplies of 50 - 100 doses a week being provided to GPs, who may have over 2000 eligible patients wanting vaccination. Another major limiting factor is that GPs and CPs must also maintain their usual workloads in addition to running vaccination clinics.

Centralised mass vaccination hubs delivered at larger venues such as schools, conference centres or sports arenas present a potential delivery mode to complement smaller local vaccination sites. Previous mass vaccination field exercises[@carr2011australia] and recent experience in delivering the Pfizer vaccine at scale through hospital hubs has shown that mass vaccination sites can administer a high number of daily vaccinations and sustain this rate of distribution. While offering a higher daily throughput, these larger hubs do require more staff and larger premises to deliver at-scale.

In this analysis, we model the potential vaccination capacity of smaller GP- or CP-based local vaccination clinics and larger school- or hospital-based mass vaccination hubs using a stochastic queueing model. This work aims to help inform public health planning for the delivery of vaccinations in Australia and internationally. 

# Methods

## Queueing Theory
Queueing is a ubiquitous phenomenon which we encounter on a day-to-day basis at shops, airports, train stations and call centres. Queueing theory is a statistical representation of this everyday process. The most basic queue can be characterised by three components: the rate of arrivals into the queue, the service time, and the number of servers.[@bhat2015introduction] If arrivals are infrequent, service times are fast and servers are plentiful (e.g. an ATM on a quiet street) then the total waiting time will be short and the average queue length will be low. If arrivals are frequent, the service time is long or the number of servers too few (e.g. at an airport on the first day of holidays) then waiting times will increase as will the average queue length. Queueing theory offers a way to improve this experience for the customer and for the server by modelling the queueing process and understanding the balance between these factors. Models of the queueing process represent arrival and service times as stochastic processes. For example, the number of new customers joining a queue in a given period can be modelled as a Poission process, or alternatively inter-arrival times can be modelled as an exponential distribution. The aim is then to estimate the characteristics of the queue, such as average (median) waiting time and queue lengths given a fixed numbers of servers, or to estimate the number of servers required to keep average waiting times at a desired level given likely service times and arrivals. 

Queue networks are formed by joining multiple queues together, either as a tandem network with an ordered series of queues, or a parallel network, with multiple parallel queues. The process of checking-in at an airport is a familiar example of a tandem queue network: first you queue up to check your luggage, then you join a second queue to pass through security screening. In a tandem queue network, the departure times for one queue, become the arrival times for the next. Other more complex features of queue networks include fork/joins and lags.[@queuecomputer2020] A fork/join arises when a queue involves multiple sub-processes. For example, as you pass through security you are "forked" from your hand luggage, which passes through a separate x-ray machine. The service times for you and your hand luggage may differ, and you can't proceed until you are reunited. Lags are waiting times that don't involve a server but nonetheless can also be modelled as a stochastic process. For example, you might linger in a bookshop between the check in stage and the security stage and this period will contribute to the overall time it takes you to arrive at your gate. 

In this analysis we represented the vaccination process as a complex queueing network involving tandem queues, fork/joins and lags. We proposed two distinct queue networks---one for mass vaccination hubs and one for local GP vaccination clinics---based on real-world examples of how these different delivery modes are currently being implemented. For both queue networks, we specified three baseline models based on low, medium and high staffing availability. We simulated data from each model to estimate staff utilisation and service times and, by calibrating the appointment schedule to keep these two metrics within reasonable limits, we estimated baseline daily throughput for each delivery mode. Finally, we performed two stress tests to explore how the different queue networks and staffing capabilities responded to system pressures, such as public health, social and political imperatives to speed up vaccine administration. The first stress test was to gradually increase the number of appointments, reflecting capability to scale up daily throughput with the same number of staff. The second stress test was to gradually decrease available staff, reflecting staff shortages due to illness or an increase in competing demands for staff time caused by, for example, an outbreak of COVID-19 infection in the unvaccinated resulting in a sudden increase in demand for nasal swab collections. 


## Settings

### Centralised mass vaccination hub
We define mass vaccination hubs as having large premises that can accommodate a high throughput of several hundred patients per day. Potential locations would need to have the necessary infrastructure to accommodate such throughput, including access to public transport, parking, disability access, bathrooms, facilities to monitor patients post-vaccination, and suitably trained and experienced staff who are on-hand to manage adverse events including anaphylaxis in an appropriate treatment setting. Examples of settings that could potentially meet these criteria include hospitals, theatres, schools, university campuses, conference centres and sports stadiums. 

### Local GP vaccination clinic
GPs (and CPs) come in different sizes, with different physical infrastructure and practice team compositions. For the purposes of this analysis we assumed that the site has access to an adequately-sized waiting area where patients will wait before and after receiving their vaccine, as well as separate rooms or cordoned-off areas for each vaccinator to allow adequate privacy during vaccination.  

## Vaccination tasks

Certain tasks must be undertaken regardless of the vaccination setting. We consider the following steps to be common to all vaccination sites, although the order that these steps are undertaken may be different in smaller versus larger sites.

* **Temperature check:** Assess presence of fever.
* **Sanitation:** Sanitise hands and put on face masks.
* **Registration:** Confirm patient has a booking.
* **Information:** Receive and review information about the vaccine.
* **Pre-vaccination checklist:** Complete a pre-vaccination checklist to identify any potential contra-indications, and review this list with a clinically-trained staff member. 
* **Consent:** Confirm that the patient is happy to proceed and record their consent.
* **Disrobing:** Expose upper arm to receive the vaccination. 
* **Vaccine preparation:** Prepare vaccines delivered in multi-dose vials close to the time that they are administered. The preparation steps differ for different vaccines.
* **Injection:** Administer the vaccine. 
* **Observation:** Monitor for any adverse reaction following vaccination.  
* **Booking:** Book appointment to receive second vaccine dose.

## Proposed queue networks

Our proposed queue networks for the mass vaccination hub and GP vaccination clinic differ in the layout of stations and how the tasks above are distributed across these stations. An overview of the two queue networks is presented in Figure \ref{fig:diagram} and these are described in more detail below. Each stage of the process is serviced by one or more _servers_ --- that is, staff who undertake the actions required for that stage. Patients are serviced by the next available server on a first-come-first-served basis, before moving on to the next station in the network. 

```{r diagram, fig.align='center', fig.cap='Queueing model for arena vaccination site (A) and GP vaccination site (B)'}

grViz("
digraph boxes_and_circles {
rankdir=TB;
graph [overlap = true, fontsize = 18, layout = dot]

subgraph cluster01 {
  label='A. Mass vaccination hub'
  
  # a 'graph' statement

  # Nodes
  node [shape = rectangle, fixedsize = true, fontcolor = Azure, style = filled, fillcolor = grey20, width = 2.0, label = '1. Entrance']
  Entrance
  
  node [shape = rectangle, fixedsize = true, fontcolor = Azure, style = filled, fillcolor = grey20, width = 2.0, label = '2. Registration']
  Registration
  
  node [shape = rectangle, fixedsize = true, fontcolor = Azure, style = filled, fillcolor = grey20, width = 2.0, label = '3. Assessment']
  Assessment
  
  node [shape = rectangle, fixedsize = true, fontcolor = Azure, style = filled, fillcolor = grey20, width = 2.0, label = '4. Vaccination']
  Vaccination
  
  node [shape = rectangle, fixedsize = true, fontcolor = Azure, style = filled, fillcolor = grey20, width = 2.0, label = '5. Observation']
  Observation

  node [shape = oval, fixedsize = true, fontcolor = azure, style = filled, fillcolor = grey20, width = 2.0, label = 'A. Vaccine delivery']
  Delivery 

  node [shape = oval, fixedsize = true, fontcolor = azure, style = filled, fillcolor = grey20, width = 2.0, label = 'B. Preparation']
  Preparation 

  # several 'edge' statements
  Entrance -> Registration [label = '  Transition time']; 
  Registration -> Assessment [label = '  Transition time']; 
  Assessment -> Vaccination [label = '  Transition time']; 
  Vaccination -> Observation  [label = '  Transition time']
  Delivery -> Preparation; Preparation -> Vaccination

}  
  
  
subgraph cluster02 {
label='B. GP vaccination clinic'

  node [shape = rectangle, fixedsize = true, fontcolor = Azure, style = filled, fillcolor = grey20, width = 2.0, label = '1. Registration']
  Registration2

  node [shape = rectangle, fixedsize = true, fontcolor = Azure, style = filled, fillcolor = grey20, width = 2.0, label = '2. Vaccination']
  Vaccination2
  
  node [shape = rectangle, fixedsize = true, fontcolor = Azure, style = filled, fillcolor = grey20, width = 2.0, label = '3. Observation']
  Observation2
  
  # several 'node' statements
  node [shape = oval, fixedsize = true, fontcolor = azure, style = filled, fillcolor = grey20, width = 2.0, label = 'A. Vaccine delivery']
  Delivery2 
  
  # several 'node' statements
  node [shape = oval, fixedsize = true, fontcolor = azure, style = filled, fillcolor = grey20, width = 2.0, label = 'B. Preparation']
  Preparation2 

  # several 'edge' statements
  Registration2 -> Vaccination2;
  Vaccination2 -> Observation2;
  Delivery2 -> Preparation2; 
  Preparation2 -> Vaccination2

}  

}
", width = 400, height = 600)

```

### Queue network for a centralised mass vaccination hub.
The proposed queue network for a mass vaccination hub is modelled on the Phase 1a (Pfizer/BioNTech) vaccination hub based at the Royal Prince Alfred Hospital (RPA) in Sydney. In this queue network, patients traverse five stations: Entrance, Registration, Assessment, Vaccination and Observation. The first four stations require the patient to wait for an available staff member so these are modelled as queues, with new arrivals serviced by the next available staff member on a first-come-first-served basis. The observation stage does not require patients to wait for an available staff member so this stage is modelled as a stochastic lag period, with longer waits for a small proportion of individuals, reflecting adverse reactions. Because mass vaccination sites require a large premises, the queue network also incorporates a short transition time between stations.

Vaccine doses must be prepared close to the time they are administered, and clearly delays to this process will result in delays at the vaccination stage. To capture this feature of the vaccination process, the queue network includes a parallel queue for vaccine preparation (see Figure \ref{fig:diagram}A) which joins with the patient queue at the vaccination station. The exact steps for the preparation process will vary for the type of vaccine being administered.

#### 1. Entrance:

Patients arrive at the premises and queue up to get a temperature check and to check-in to the venue. Hand sanitiser and masks are made available. This station would be overseen by one or more health professional staff but could also be supplemented with administrative staff to help marshal patients to the next station.

#### 2. Registration: 

Having passed through the entrance station, patients join the queue for registration. The registration desks are staffed by one or more personnel. As part of the registration process, patients will have their current appointment confirmed and potentially could also book their second vaccination. They are provided with pre-vaccination information to read while they wait for the next station. 

#### 3. Assessment: 

Once registered, patients join the queue for assessment. The purpose of assessment is to make sure that the patient is clinically suitable to receive the vaccine. During this stage the patient's consent is also recorded.

#### 4. Vaccination:   

Having been given final clearance to receive the vaccine at the assessment station, patients join the queue for vaccination. Once a vaccinator becomes available, the patient can take a seat and expose their upper arm. The vaccinator confirms the patient's name and details then administers the vaccine. The vaccinator applies a dressing to the vaccination site, notes the vaccination time on a sticker and applies this to the patient's shoulder or lapel. 

#### 5. Observation:

Once vaccinated, patients advance to an observation area where they take a seat and wait for the required time to ensure they experience no immediate adverse reaction. A staff member will advise the patient once their  observation time has passed, at which point they can make their way out of the premises. 

#### A. Vaccine delivery: 

The proposed queue network does not set out to model vaccine delivery to the vaccination site. All of our analyses assume that an adequate supply of vaccine doses is available at the premises in the quantities required to service all booked patients. 

#### B. Vaccine preparation: 

Vaccines are delivered in multi-dose vials containing 5-6 doses (Pfizer) or 8-10 doses (AstraZeneca). The exact preparation steps will differ depending on the vaccine being prepared. Steps incorporated at this station may include logging the vial, visual inspection of the dose, reconstitution (for the Pfizer vaccine), and drawing up the vaccine into syringes. 


### Queue network for a local GP vaccination clinic

The proposed queue network for a local GP vaccination clinic is presented in Figure \ref{fig:diagram}B. In this queue network, patients traverse three distinct stations: Registration, Vaccination and Observation. To advance to the Registration and Vaccination stations, patients must wait for the next available staff member so these stations are modelled as queueing processes, with patients serviced by the next available staff member on a first-come-first-served basis. As with the mass vaccination model, the observation station is modelled as a stochastic lag period rather than a queue, and there is a parallel queue specified for vaccine preparation which joins at the vaccination station. The time taken to walk between stations in a GP clinic is assumed to be negligible and not included in the model. The distribution of vaccination tasks across these stations is described in detail below.

#### Registration: 

Patients arrive at the premises, and receive a temperature check on entry. They are provided with pre-vaccination information and a check-list of contra-indicated items, either as a paper form or on a hand-held tablet. While seated in a waiting area, they read the provided information and complete the pre-vaccination checklist. Once complete, they return the paper form or tablet to the staff member and wait for the next available vaccinator. This process is assumed to take place in a shared waiting area, which may also be used for the observation step.

#### Vaccination: 

Once a vaccinator becomes available, the patient advances to the vaccination area, which may be a doctor's office or other suitable partitioned area. The vaccinator reviews the patient's pre-vaccination checklist, probes any items that have been checked and records the patient's consent. The patient exposes their upper arm and the vaccinator administers the vaccination and applies a dressing to the vaccination site. Finally the vaccinator notes the vaccination time on a sticker and applies this to the patients shoulder or lapel. 

#### Observation: 

Once vaccinated, patients return to the waiting area where they take a seat and wait for the allotted time to ensure they experience no adverse reaction. The waiting area may be monitored by the same staff member who is managing the registration process.  


## Assumed service times

For both the mass vaccination hub and GP vaccination clinic, the station service times were modelled as exponential processes with fixed minimum service times. Such exponential simulations reflect the typically observed situation of most patients taking a relatively short time to process, but with a long "tail" of some patients taking somewhat longer, and a few taking a very long time. The exception is the observation station, which was modelled as bimodal distribution, with normally distributed observation times for patients who did not experience an adverse reaction and exponentially distributed observation times for a small random subset to reflect a low incidence of adverse reactions. The assumed minimum service times and exponential rate parameters for each station are summarised in Table \ref{tab:serviceTimeAssumptions}), together with the resulting distribution of service times. 


```{r serviceTimesAssumptions}

df <- data.frame(
   
   station = c('Preparation', 'Entrance', 'Registration', 'Assessment', 'Vaccination', 'Observation', 'Adverse reaction', 'Preparation', 'Registration', 'Vaccination', 'Observation', 'Adverse reaction'),
   form = c(rep('exponential', 5), 'normal', rep('exponential', 4), 'normal', 'exponential'), 
   formula = c('1 + exp(3)', '2 + exp(1)', '3 + exp(0.7)', '2 + exp(1)', '3 + exp(1)', 'norm(20, 0.5)', '20 + exp(0.1)', 
               '1 + exp(2)', '1 + exp(3)', '1 + exp(3)', 'norm(20, 0.5)', '20 + exp(0.1)'),
   p5 = NA,
   p25 = NA,
   p50 = NA,
   p75 = NA,
   p95 = NA,
   dist = ""
   
)

# Generate distributions based on given parameters and large N
spark_list <- list(1 + rexp(1000, 3),
                   2 + rexp(1000, 1),
                   3 + rexp(1000, 0.7),
                   2 + rexp(1000, 1),
                   3 + rexp(1000, 1),
                   rnorm(1000, 20, 0.1),
                   20 + rexp(1000, 0.1),
                   1 + rexp(1000, 3),
                   3 + rexp(1000, 1),
                   5 + rexp(1000, 0.5),
                   rnorm(1000, 20, 0.5),
                   20 + rexp(1000, 0.1)
)

# Fill in the blanks for the DF
for(i in 1:12){
   df$p5[i] <- quantile(spark_list[[i]], p = .05)
   df$p25[i] <- quantile(spark_list[[i]], p = .25)
   df$p50[i] <- quantile(spark_list[[i]], p = .50)
   df$p75[i] <- quantile(spark_list[[i]], p = .75)
   df$p95[i] <- quantile(spark_list[[i]], p = .95)
}

# Tabulate using kableExtra
df %>% 
   kbl(
      format = 'latex',
      booktabs = TRUE,
      col.names = c('Station', 'Form', 'Formula', '5%', '25%', '50%', '75%', '95%', 'Distribution'),
      digits = 1,
      caption = "Service time parameter values and resulting distributions",
      label = 'serviceTimeAssumptions'
   ) %>%
   column_spec(1, width = '4cm') %>% 
   column_spec(2, width = '2cm') %>% 
   column_spec(3, width = '2cm') %>% 
   column_spec(4, width = '1cm') %>% 
   column_spec(5, width = '1cm') %>% 
   column_spec(6, width = '1cm') %>% 
   column_spec(7, width = '1cm') %>% 
   column_spec(8, width = '1cm') %>%
   column_spec(9, image = spec_hist(spark_list,  breaks = 40, same_lim = FALSE)) %>%
   add_header_above(c(" " = 3, "Percentiles" = 5, " ")) %>%
   group_rows("Arena model", 1, 7, indent = FALSE) %>%
   group_rows("GP model", 8, 12, indent = FALSE) %>%
   kable_styling(latex_options =  c("striped", "hold_position", "scale_down"), 
                 full_width = FALSE, 
                 position = "left")  

```


## Assumed arrival times 

Arrivals for both queue networks were based on fixed appointment slots across an eight hour clinic running from 8am to 4pm. For mass vaccination hubs we assumed that appointment arrival times would be given on the hour, every hour. For local GP hubs we assumed that appointment slots would be provided in ten minute intervals. Actual arrival times were based on the appointment schedule with the addition of some random noise, reflecting that most people would turn up somewhat before their allotted time, while a smaller proportion would arrive after their allotted time. Arrival times also accounted for a small proportion of no-shows, set at 2% for both local and mass vaccination hubs. The actual number of arrivals per appointment interval was calibrated to keep the queue performance metrics within reasonable limits. As an example, Figure \ref{fig:arrivalTimes} presents simulated arrival times for a mass vaccination hub at the rate of 120 arrivals every hour, and a GP vaccination clinic at a rate of 4 arrivals every 10 minutes.

```{r arrivalTimes, fig.align='center', fig.cap='Randomly generated arrival times for a mass vaccination hub (A) and a GP vaccination clinic (B)', fig.height=3.0, fig.width=6.5}

# Simulate arrivals data based
dfArrivals1 <- data.frame(time = arrivals(120, 60, 0, 5, 0.02)*60 + parse_date_time("01-04-2021 06:15", "dmY HM"))
dfArrivals2 <- data.frame(time = arrivals(4, 10, -3, 1, 0.02)*60 + parse_date_time("01-04-2021 06:15", "dmY HM"))

# Plot arrivals data

p1 <- ggplot(data = dfArrivals1,
       aes(x = time)) +
      geom_histogram(colour = 'white', binwidth = 600) +
      scale_x_datetime(' ', date_labels = '%H', date_breaks = '1 hour', limits = c(dmy_hm("01-04-2021 08:00"), dmy_hm("01-04-2021 16:00"))) +
      scale_y_continuous('Number of\narrivals')

p2 <- ggplot(data = dfArrivals2,
       aes(x = time)) +
      geom_histogram(color = 'white', binwidth = 600) +
      scale_x_datetime('Time of day (hours)', date_labels = '%H', date_breaks = '1 hour', limits = c(dmy_hm("01-04-2021 08:00"), dmy_hm("01-04-2021 16:00"))) +
      scale_y_continuous('Number of\narrivals', limits = c(0,10), breaks = seq(0,10,2))

# Combine plots
ggpubr::ggarrange(p1, p2, ncol = 1, labels = c('A', 'B'), vjust = c(1.2, 0), hjust = -.2)

```


## Staffing levels 

For each of the proposed queue networks we specified models with low, medium and high staffing availability, ranging from 21 to 63 healthcare staff for mass vaccination sites and from 4 to 12 healthcare staff for GP vaccination clinics (Table \ref{tab:staffing}). The distribution of staff across the stations of the queue network was kept stable regardless of the total staffing capacity. For example, for the mass vaccination model there were three staff assigned to the Registration station for every one staff member assigned to the Preparation station, regardless of the assumed size of the hub. This equivalence facilitated valid comparisons across hub sizes presented later in the analysis. 

```{r}

df <- data.frame(
   
   size = rep(c('low', 'medium', 'high'), 2),
   preparation = c(2,4,6,1,2,3),
   arrival = c(4,8,12,'*','*','*'),
   registration = c(6,12,18,1,2,3),
   assessment = c(4,8,12,'*','*','*'),
   vaccination = c(5,10,15,2,4,6),
   total = c(21,42,63,4,8,12)
)

kbl(df,
    format = 'latex',
    booktabs = TRUE,
    col.names = c('Size', 'Preparation', 'Entrance', 'Registration', 'Assessment', 'Vaccination', 'Total'),
    digits = 1,
    caption = "Staff numbers by station for low, medium and high staffing availability",
    label = 'staffing',
    align = c('l',rep('r',6))
) %>%
   column_spec(1, width = '2cm') %>% 
   column_spec(2, width = '2cm') %>% 
   column_spec(3, width = '2cm') %>% 
   column_spec(4, width = '2cm') %>% 
   column_spec(5, width = '2cm') %>% 
   column_spec(6, width = '2cm')  %>% 
   column_spec(7, width = '2cm')  %>% 
   add_header_above(c(" " = 1, "Staff numbers" = 6)) %>%
   group_rows("Mass vaccination hub", 1, 3, indent = FALSE) %>%
   group_rows("Local GP hub", 4, 6, indent = FALSE) %>%
   kable_styling(latex_options =  c("striped", "hold_position", "scale_down"), 
                 full_width = FALSE, 
                 position = "left") %>% 
   footnote(symbol = 'Not applicable')

```

Note that the total staffing numbers given in Table \ref{tab:staffing} only include staffing requirements for the stations in the modelled queue network that represent a queueing process, and thus do not cover all staffing needs to successfully run a vaccination clinic. For example, the staff needed to oversee the observation station are not included because patients do not have to queue up to be serviced at this station. Also not included here are other essential support staff, such as supervisors, cleaners, marshals and caterers. The number and type of support staff required will vary depending on the size of the vaccination hub, and must also be taken into account when planning vaccine distribution. 

## Queue performance

We use two metrics to quantify queue performance, total processing time and staff utilisation. Total processing time, measured here in minutes, is the total time from start to finish of the queue network. Staff utilisation is the average proportion of staff that are busy across the simulation run. An established property of queueing models is that queue performance rapidly degrades as staff utilisation exceeds 80%.[@little1961proof] 

## Software and code

The analysis was performed using R version 4.0.3[@R-base] and associated packages.[@tidyverse2019] Queueing models were simulated using the `queuecomputer` package.[@queuecomputer2020] The complete source code to reproduce this analysis can be accessed at https://github.com/CBDRH/vaccineQueueNetworks.  

# Results

## Calibrating arrivals to achieve reasonable service times and staff utilisation

In this section we present estimates of median processing times and average staff utilisation based on (i) the queue networks presented in Figure \ref{fig:diagram} and (ii) the stochastic service times described in Table \ref{tab:serviceTimeAssumptions}. The number of available staff (and thus the number of open queues) at each station is fixed to be constant at the levels set out in Table \ref{tab:staffing}. Within each setting, the frequency of arrivals is increased gradually. For example, for the mass vaccination site with low staffing numbers, the frequency of arrivals was increased from 10 per hour to 110 per hour, in increments of 25. For each of the six resulting models, the average (median) processing time and staff utilisation across `r nSim` simulation runs are presented in Figure \ref{fig:processingTimes} and \ref{fig:staffUtilisation} respectively.


```{r processingTimes, fig.align='center', fig.cap='Median processing times by arrival frequency for a mass vaccination hub (A) and a GP vaccination clinic (B)', fig.height=3.5, fig.width=6.5}

# Vector of arrival loads (needs to match a-e simulations in simulations.R)
rpaArr <- c(rep(c(10, 35, 60, 85, 110), 1), rep(c(20, 70, 120, 170, 220), 1), rep(c(60, 120, 180, 240, 300), 1))
gpArr <- c(rep(c(1, 2, 3, 4, 5), 1), rep(c(1, 2, 4, 6, 10), 1), rep(c(2, 4, 6, 8, 12), 1))

p1 <- queueTimesRPA %>% 
         filter(test==1 & station == 'Total') %>% 
         group_by(size, level) %>% 
         summarise(median = median(mins)) %>% 
         ungroup() %>% 
         mutate(arr = rpaArr) %>% 
         ggplot(aes(y=arr, x=median)) + 
         annotate('rect', xmin = 30, xmax = 60, ymin = 0, ymax = 300, fill = 'seagreen', alpha = 0.2) +  
         geom_point(size = 1.5)  + 
         facet_wrap(~size, ncol = 3, scales = 'free') + 
         scale_x_continuous(' ', limits=c(0, 300), breaks = seq(0,300,50), labels = seq(0,300,50)) +
         scale_y_continuous('Arrivals every\n60 minutes', breaks = scales::pretty_breaks(), limits=c(0, 300))



p2 <- queueTimesGP %>% 
         filter(test==1 & station == 'Total') %>% 
         group_by(size, level) %>% 
         summarise(median = median(mins)) %>% 
         ungroup() %>% 
         mutate(arr = gpArr) %>% 
         ggplot(aes(y=arr, x=median)) +  
         annotate('rect', xmin = 30, xmax = 60, ymin = 0, ymax = 15, fill = 'seagreen', alpha = 0.2) + 
         geom_point(size = 1.5)  + 
         facet_wrap(~size, ncol = 3, scales = 'free') + 
         scale_x_continuous('Median total processing time (minutes)', limits=c(0, 300)) +
         scale_y_continuous('Arrivals every\n10 minutes', breaks = scales::pretty_breaks(), limits=c(0, 15))

ggpubr::ggarrange(p1, p2, ncol = 1, labels = c('A', 'B'), vjust = c(1.2, 0), hjust = -.2)

```

Figure \ref{fig:processingTimes} presents the median processing time as the arrival frequency increases. When arrivals are set to their lowest value, all processing times are within between 30 and 60 minutes (the shaded band). In general, small increases to the average arrival rate have a negligible impact on the overall median processing time. However, once a certain threshold is reached, the median processing time quickly escalates. For both mass vaccination hubs and GP vaccination clinics, the critical threshold is lower in venues with relatively low staffing and higher in venues with relatively high staffing, a point to which we shall return later. 

Figure \ref{fig:staffUtilisation} presents the corresponding arithmetic mean staff utilisation for the Vaccination station, which was chosen as an example because it is common to both the mass vaccination hub and the GP vaccination clinic. Utilisation for the other stations are not presented but display similar patterns.

```{r staffUtilisation, fig.align='center', fig.cap='Average staff utilisation by arrival frequency for a mass vaccination hub (A) and a GP vaccination clinic (B)', fig.height=3.5, fig.width=6.5}

# Vector of arrival loads (needs to match a-e simulations in simulations.R)
rpaArr <- c(rep(c(10, 35, 60, 85, 110), 1), rep(c(20, 70, 120, 170, 220), 1), rep(c(60, 120, 180, 240, 300), 1))
gpArr <- c(rep(c(1, 2, 3, 4, 5), 1), rep(c(1, 2, 4, 6, 10), 1), rep(c(2, 4, 6, 8, 12), 1))

p1 <- utilTimesRPA %>% 
   filter(test==1 & station =='Vaccination') %>% 
   group_by(size, station, level) %>% 
   summarise(mean = mean(util))  %>% 
   ungroup() %>% 
   mutate(arr = rpaArr) %>% 
   ggplot(aes(y=arr, x=mean)) + 
      annotate('rect', xmin = 0.5, xmax = 0.7, ymin = 0, ymax = 300, fill = 'seagreen', alpha = 0.2) + 
      geom_point(size = 1.5) + 
      facet_wrap(~size, ncol = 3, scales = 'free_y') + 
      scale_x_continuous(' ', limits=c(0, 1), breaks = seq(0,1,.2)) +
      scale_y_continuous('Arrivals every\n60 minutes', limits=c(0, 300))


p2 <- utilTimesGP %>% 
   filter(test==1 & station =='Vaccination') %>% 
   group_by(size, station, level) %>% 
   summarise(mean = mean(util))  %>% 
   ungroup() %>% 
   mutate(arr = gpArr) %>% 
   ggplot(aes(y=arr, x=mean)) + 
   annotate('rect', xmin = 0.5, xmax = 0.7, ymin = 0, ymax = 15, fill = 'seagreen', alpha = 0.2) + 
   geom_point(size = 1.5) + 
   facet_wrap(~size, ncol = 3, scales = 'free_y') + 
   scale_x_continuous('Staff utilisation factor', limits=c(0, 1), breaks = seq(0,1,.2)) +
   scale_y_continuous('Arrivals every\n10 minutes', breaks = scales::pretty_breaks(), limits=c(0, 15))


ggpubr::ggarrange(p1, p2, ncol = 1, labels = c('A', 'B'), vjust = c(1.2, 0), hjust = -.2)

```

As the arrival frequency increases, mean staff utilisation grows gradually. The shaded area indicates a staff utilisation factor between 0.5 and 0.7. Beyond this level, mean utilisation rapidly increases as arrivals increase. 

These results emphasise the delicate balance between arrival frequency, mean staff utilisation and processing times. If arrivals are too low, processing times will be at an acceptable level but the available staff will be under-utilised. As arrivals increase, processing times and staff utilisation increase accordingly. However if the rate of arrivals grows too high, mean staff utilisation passes a critical threshold and processing times expand beyond reasonable levels. 

Based on this calibration exercise, we specified the number of arrivals such that the median processing times remained under an hour, and the staff utilisation did not exceed 0.7 for any station. The chosen arrival frequencies that met this criteria are presented in Table \ref{tab:arrivalFreq}.

```{r}

df <- data.frame(
   
   size = rep(c('low', 'medium', 'high'), 2),
   interval = c(rep('60 minutes', 3), rep('10 minutes', 3)),
   arrivals = c(60, 120, 180, 2, 4, 6)

)

kbl(df,
    format = 'latex',
    booktabs = TRUE,
    col.names = c('Size', 'Appointment interval', 'Arrivals per interval'),
    digits = 1,
    caption = "Arrival frequency by station for low, medium and high staffing availability",
    label = 'arrivalFreq',
    align = c('lrr')
) %>%
   column_spec(1, width = '4cm') %>% 
   column_spec(2, width = '2cm') %>% 
   column_spec(3, width = '2cm') %>% 
   group_rows("Mass vaccination hub", 1, 3, indent = FALSE) %>%
   group_rows("GP vaccination clinic", 4, 6, indent = FALSE) %>%
   kable_styling(latex_options =  c("striped", "hold_position"), 
                 full_width = FALSE, 
                 position = "center")

```


The chosen arrival frequencies were selected to increase linearly across the low, medium and high staffing models: arrivals for the mass vaccination hub were set at 60, 120 and 180 arrivals per hour at relatively low, medium and high staffed hubs; arrivals for GP clinics were set at 2, 4, and 6 arrivals per 10 minutes. Scaling the arrivals and staffing in this way ensured that the baseline staff utilisation and processing times remained constant across all models within the given queue network (see Figure \ref{fig:baselineUtilisation} and Figure \ref{fig:baselineProcessingTimes}). This equivalence facilitates comparisons between hub sizes within the two queue networks. 

```{r baselineUtilisation, fig.align='center', fig.cap='Baseline staff utilisation factor for mass vaccination hubs (A) and GP vaccination clinics (B)', fig.height=3.0, fig.width=6.5}
p1 <- utilTimesRPA %>%
  filter(test==2 & level == 1) %>%
  group_by(station, level, size) %>%
  summarise(mean = mean(util)) %>%
  ggplot(aes(y = station, x = mean)) +
  annotate('rect', xmin = 0.5, xmax = 0.7, ymin = 0.5, ymax = 5.5, fill = 'seagreen', alpha = 0.2) + 
  geom_point(size = 2) +
  facet_wrap(~size, nrow = 1) +
  scale_y_discrete(NULL, limits = rev(levels(utilTimesRPA$station))) +
  scale_x_continuous("Average staff utilisation factor", labels = c('0', "", '.5', '', '1'), limits = c(0,1), breaks = seq(0,1,.25))

p2 <- utilTimesGP %>%
  filter(test==2 & level == 1) %>%
  group_by(station, level, size) %>%
  summarise(mean = mean(util)) %>%
  filter(station %in% c('Preparation', 'Registration', 'Vaccination')) %>%
  ggplot(aes(y = station, x = mean)) +
  annotate('rect', xmin = 0.5, xmax = 0.7, ymin = 0.5, ymax = 3.5, fill = 'seagreen', alpha = 0.2) +
  geom_point(size = 2) +
  facet_wrap(~size, nrow = 1) +
  scale_y_discrete(NULL, limits = c('Vaccination', 'Registration', 'Preparation')) +
  scale_x_continuous("Average staff utilisation factor", labels = c('0', "", '.5', '', '1'), limits = c(0,1), breaks = seq(0,1,.25))

ggpubr::ggarrange(p1, p2, ncol = 1, labels = c('A', 'B'), vjust = c(1.2, 0), hjust = -.2)

```

```{r baselineProcessingTimes, fig.align='center', fig.cap='Baseline median processing times for the mass vaccination hub (A) and GP vaccination clinic (B)', fig.height=3.5, fig.width=6.5}
# Save median queue time across all sites
medianqTime1 <- queueTimesRPA %>%
  filter(test==2 & level == 1 & station=='Total') %>%
  summarise(t = median(mins)) %>%
  as.numeric()

p1 <- queueTimesRPA %>%
  filter(test==2 & level == 1 & station=='Total') %>%
  ggplot(aes(y = mins, x = 1)) +
  geom_hline(aes(yintercept = medianqTime1), color = 'seagreen', size = 1.2, alpha = 0.2) +
  geom_boxplot() +
  facet_wrap(~size, nrow = 1) +
  scale_x_discrete(NULL) +
  scale_y_continuous("Processing time\n(minutess)", limits = c(0, 100), breaks = seq(0, 100, 20))

medianqTime2 <- queueTimesGP %>%
  filter(test==2 & level == 1 & station=='Total') %>%
  summarise(t = median(mins)) %>%
  as.numeric()

p2 <- queueTimesGP %>%
  filter(test==2 & level == 1 & station=='Total') %>%
  ggplot(aes(y = mins, x = 1)) +
  geom_hline(aes(yintercept = medianqTime2), color = 'seagreen', size = 1.2, alpha = 0.2) +
  geom_boxplot() +
  facet_wrap(~size, nrow = 1) +
  scale_x_discrete(NULL) +
  scale_y_continuous("Processing time\n(minutes)", limits = c(0, 60), breaks = seq(0, 60, 20))

ggpubr::ggarrange(p1, p2, ncol = 1, labels = c('A', 'B'), vjust = c(1.2, 0), hjust = -.2)


```

The results in Figures \ref{fig:baselineUtilisation} and \ref{fig:baselineProcessingTimes} illustrate that for both the mass vaccination hubs and GP clinic baseline models, the staff utilisation and processing times are stable regardless of the staffing capacity. This equivalence is important for the stress tests reported below, because it means the different models are starting from the same baseline in terms of queue performance. 

## Daily throughput

Based on the calibrated baseline models, we can now estimate the number of daily vaccinations possible at different site capacities while maintaining processing times and staff utilisation within reasonable limits. The results are presented in Figure \ref{fig:baselineThroughput}.

```{r baselineThroughput, fig.align='center', fig.cap='Baseline daily throughput for mass vaccination hubs (A) and GP vaccination clinics (B)', fig.height=3.5, fig.width=6.5}
p1 <- queueTimesRPA %>%
      filter(test==2 & level == 1 & station=='Total') %>%
      group_by(size, iter) %>%
      summarise(n = max(id)) %>%
      ggplot(aes(x = size, y = n)) +
      geom_jitter(width = 1, shape = 1, color = 'grey40') +
      geom_smooth(method = 'lm', colour = RColorBrewer::brewer.pal(5, 'Purples')[[5]]) +
      scale_x_continuous(' ', breaks = c(21, 42, 63)) +
      scale_y_continuous('Daily\nvaccinations', limits = c(0, 1500), labels = scales::comma)

p2 <- queueTimesGP %>%
      filter(test==2 & level == 1 & station=='Total') %>%
      group_by(size, iter) %>%
      summarise(n = max(id)) %>%
      ggplot(aes(x = size, y = n)) +
      geom_jitter(width = 0.3, shape = 1, color = 'grey40') +
      geom_smooth(method = 'lm', colour = RColorBrewer::brewer.pal(5, 'Purples')[[5]]) +
      scale_x_continuous('Healthcare staff numbers', limits = c(3.8, 12.2), breaks = c(4, 8, 12)) +
      scale_y_continuous('Daily\nvaccinations', limits = c(0, 300), labels = scales::comma)

ggpubr::ggarrange(p1, p2, ncol = 1, labels = c('A', 'B'), vjust = c(1.2, 0), hjust = -.2)

```

The results show that, while holding queue performance metrics constant, the number of daily vaccinations scales linearly with increasing healthcare staff for both the mass vaccination hub and GP vaccination clinic. The potential daily throughput for an eight hour clinic at a mass vaccination hub ranged from around 500 vaccinations for a relatively small hub to 1,400 vaccinations a day for a relatively large hub. For GP vaccination clinics, the estimated daily throughput ranged from about 100 vaccinations a day for a relatively small practice to almost 300 a day for a relatively large practice.

## Stress tests

In this section, we apply two stress tests to our baseline models. The first test was to gradually increase arrivals, which could reflect efforts to increase throughput with the same staffing levels. This could arise if the production of vaccine doses increased or there were other sudden imperatives to accelerate vacccination, such as a large-scale COVID-19 outbreak. The second stress test was to gradually decrease staff numbers, which could reflect inevitable fluctuations in staff availability due to illness etc, or healthcare staff having to attend to a medical emergencies (including COVID-19 outbreaks) or routine duties. 

### Increasing arrivals

Figure \ref{fig:processingTimeTest} presents the median processing time based on incrementing the arrival frequency from the levels set for the baseline models. For mass vaccination hubs and GP clinics, increasing the number of arrivals results in increased processing times. However, the rate of increase in processing times is steeper for sites with relatively low healthcare staff compared to sites with relatively high healthcare staffing.

```{r processingTimeTest, fig.align='center', fig.cap='Increase in processing time with increased arrivals by site size for mass vaccination hubs (A) and GP vaccination clinics (B)', fig.height=4.0, fig.width=6.5}
p1 <- queueTimesRPA %>%
      filter(test==3 & station=='Total') %>%
      ggplot(aes(x = factor(size), y = mins, fill = factor(level))) +
      geom_boxplot(outlier.shape = NA) +
      scale_x_discrete('Number of healthcare staff') +
      scale_y_continuous('Total processing\ntime (minutes)', limits = c(0, NA)) +
      scale_fill_brewer('Arrivals\nincrease\n(per hour)', 
                        label = c('+0', '+10', '+20', '+30', '+40'),
                        palette = 'Purples')

p2 <- queueTimesGP %>%
      filter(test==3 & station=='Total') %>%
      ggplot(aes(x = factor(size), y = mins, fill = factor(level))) +
      geom_boxplot(outlier.shape = NA) +
      scale_x_discrete('Number of healthcare staff') +
      scale_y_continuous('Total processing\ntime (minutes)', limits = c(0, NA)) +
      scale_fill_brewer('Arrivals\nincrease\n(10 mins)', 
                        label = c('+0', '+1', '+2', '+3', '+4'),
                        palette = 'Reds')

ggpubr::ggarrange(p1, p2, ncol = 1, labels = c('A', 'B'), vjust = c(1.2, 0), hjust = -.2)

```


```{r staffShortageTest, fig.align='center', fig.cap='Increase in processing time with staff shortages by site size', fig.height=4.0, fig.width=6.5}
p1 <- queueTimesRPA %>%
      filter(test==2 & station=='Total') %>%
      ggplot(aes(x = factor(size), y = mins, fill = factor(level))) +
      geom_boxplot(outlier.shape = NA) +
      scale_x_discrete(' ') +
      scale_y_continuous('Total processing\ntime (minutes)', limits = c(0, NA)) +
      scale_fill_brewer('Staff\nShortage', label = seq(0, 4, 1), palette = 'Purples')

p2 <- queueTimesGP %>%
      filter(sim %in% c('6', '7', '21', '22', '23', '24', '36', '37', '38', '39', '40'), station=='Total') %>%
      ggplot(aes(x = factor(size), y = mins, fill = factor(level))) +
      geom_boxplot(outlier.shape = NA) +
      scale_x_discrete('Number of healthcare staff') +
      scale_y_continuous('Total processing\ntime (minutes)', limits = c(0, NA)) +
      scale_fill_brewer('Staff\nShortage', label = seq(0, 4, 1), palette = 'Reds')

ggpubr::ggarrange(p1, p2, ncol = 1, labels = c('A', 'B'), vjust = c(1.2, 0), hjust = -.2)

```
 
### Staff shortages

Figure \ref{fig:staffShortageTest} presents the average processing time based on gradually decreasing the available staff for a given model. These results show that---unsurprisingly---small vaccination sites with limited staff numbers are quickly affected by staff shortages, whereas large vaccination hubs with more staff can still maintain queue performance with the same number of staff shortages. 


# Interactive web-based queue simulation applet

To accompany the analysis presented here, we have developed an interactive web-based queue simulation applet. This applet provides a graphical user interface to the mass vaccination and GP clinic queueing networks estimated with the R package `queuecomputer`. On accessing the applet in a web browser, the results from two default models are presented. These models have been parameterised to reflect the medium-sized baseline model presented here, i.e. the mass vaccination centre with 42 staff members and the GP clinic with eight staff members. The interactive interface allows users to adjust the assumed arrival times, service times and available staff to reflect their own situation or assumptions. Queue performance is summarised in terms of total throughput, processing times and staff utilisation (Figure \ref{fig:shinyScreenshot}).

```{r shinyScreenshot, fig.align='center', fig.cap='Screenshot of the interactive web-based queue simulation applet', fig.height=4.0, fig.width=6.5, dpi = 1000}
knitr::include_graphics('../Data/queue-sim-tool-screenshot.png')
```

The applet can be accessed at https://cbdrh.shinyapps.io/queueSim. The underlying source code is available on GitHub at  https://github.com/CBDRH/vaccineQueueNetworks. Planned extensions of this applet will allow users to download a summary of their specified assumptions and queue perfromance metrics, as well as the underlying simulation data. 

# Discussion

## Summary and discussion of main results 
We have used queueing simulation methods to model the vaccination process based on two modes of delivery: a large mass vaccination hub and a small GP vaccination clinic. For each delivery mode, we calibrated the number of arrivals that could be vaccinated over an eight hour period while keeping two queue performance measures---staff utilisation and total processing time---constrained to reasonable levels. Our results provide estimates of potential daily throughput for these distinct vaccine delivery modes across a range of staffing levels. Under our assumed service times, a relatively small GP clinic could perform around 100 vaccinations over an eight-hour clinic, while a relatively large mass vaccination hub could perform around 1,400 vaccinations over the same time period. Put differently, one large mass vaccination hub can achieve the same coverage as 14 GP small vaccination clinics. 

These throughput estimates have reasonable face-validity. The mass vaccination hub trialled by NSW Health in a 2008 pandemic response field exercise administered 498 vaccines in five hours using a mass vaccination process delivered through a local school.[@carr2011australia] The RPA Pfizer clinic has been delivering between 1,100 and 1,400 vaccinations per day throughout March 2021. 

Our models suggest that daily vaccination capacity scales linearly with staffing capacity while maintaining a constant queue performance. However, there are several other facets of the vaccine delivery process that are likely to offer economies-of-scale. For example, given a low incidence of adverse events, a high-capacity post-vaccination area observation area could be overseen by a single staff member. Economies-of-scale are also likely to apply to vaccine transport, because it may be logistically more efficient and cost-effective to coordinate a single delivery to one centralised hub rather than multiple deliveries to numerous smaller clinics, especially given that the cold-chain must be rigorously maintained at all stages of vaccine transport and handling. 

By stressing our baseline models, we have shown that mass vaccination hubs are better placed to scale up daily throughput with a fixed staff capacity while maintaining acceptable queue performance. We have also shown that mass vaccination hubs are also are more resilient to staff absences or some staff being redirected to other urgent duties. 

## Policy implications 
To date, the Australian Government's approach to vaccine delivery has relied on hospital hubs, private contractors and the Australian Defence Forces to administer the Pfizer vaccine to the highest priority phase, whereas delivery of subsequent phases is planned through smaller sites, including general practices, Aboriginal Controlled Community Health Services, and community pharmacies, to administer the AstraZeneca vaccine to the bulk of the Australian population. To date there has been little emphasis on the use of mass vaccination hubs to be included in vaccination efforts, although previous pandemic planning exercises found this model to be effective,[@carr2011australia] and mass vaccination sites have been implemented successfully in Australia (during Phase 1a of the COVID-19 vaccine roll-out) and overseas.[@baraniuk2021covid; @goralnick2021mass] 

Mass vaccination hubs and GP clinics offer distinct advantages as modes of vaccine delivery. As we have shown, mass vaccination hubs are more robust to increased throughput and staff shortages or absences. Smaller GPs and CPs are more likely to be vulnerable to concomitant, competing workplace demands, which fluctuate during the year and increase notably during the winter months. GPs have the advantage of existing infrastructure and existing relationships with patients. GPs are also highly flexible and can adapt to local circumstances and specific needs, as seen with carpark drive-through testing sites, which many practices helped set up during the COVID-19 pandemic.[@tanne2020covid] The optimal vaccination site may vary for different population segments. Older people or clinically vulnerable patients may benefit from attending their local GP who will be familiar with their medical history. Working adults may benefit from extended hours or more flexible appointment scheduling that could be offered by a mass vaccination hub, as may younger adults---especially among marginalised populations---who are less likely to have a regular GP.[@kang2020relationship] It may be easiest to reach university students, and in due course younger children, through vaccination hubs set up in campuses and schools.

Expanding GP capacity to vaccinate, and supporting practices to offer more flexible models for vaccination, will assist in achieving Australia‚Äôs mass vaccination goals. Other vaccination delivery modes such as adapting drive-through mass testing sites should also be explored. A combination of expanded mass vaccination hubs and expanded GP vaccination is likely to achieve mass vaccination faster than either alone. 

## Limitations 
An obvious limitation of our analysis is that the queueing models assume sufficiently available vaccine doses. We have not attempted to model the process of vaccine procurement or the logistics of delivering vaccine doses to the venues where they will of administered. Our analysis does not account for essential staff who are not involved in the queueing process but do need to be considered when estimating staffing requirements. The assumed queue networks rely on subjective assumptions of the distribution of service times at each station. We specified service times that had reasonable face-validity and produced realistic estimates of overall processing times. This could be further improved in the future through a time-use survey to empirically estimate service time distributions for each station in a queue network. Our web-based queueing simulation applet allows queue performance to be explored under different sets of assumptions for service times, appointment schedules and staffing availability.   
 
## Conclusion 
 
Stochastic queueing models can be used to simulate vaccination queues, estimate daily throughput based on given staff availability and inform service delivery. Different modes of vaccine distribution have different benefits and challenges. Mass vaccination clinics offer a higher daily throughput and are more resilient to increased arrivals and decreased staff availability, however they require larger premises and higher staffing numbers. GP vaccination clinics can perform vaccinations at a similar rate per staff member compared to mass vaccination hubs, however it may be difficult to sustain a high throughput given existing workloads and incomplete coverage across accredited practices. A diverse profile of vaccination sites, drawing on the benefits of both distribution modes, may help to maximise the daily vaccination rate and vaccinate the Australian population against COVID-19 as quickly as possible.  


# Contributions
MH, TC and LJ conceived of the study; MH, OF and TC wrote the R code; MH drafted the manuscript; all authors reviewed and edited the manuscript.

# Acknowledgements
This research was supported by the generous assistance of Ian Sharp, philanthropic supporter of UNSW research, and by a research seed grant provided by the Sydney Partnership for Health, Education, Research and Enterprise (SPHERE) Infectious diseases, Immunity and Inflammation (Triple-I) Clinical Academic Group.

\newpage

# References
